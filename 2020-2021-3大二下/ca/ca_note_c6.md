# ca第六章 数据级并行技术

向量数据：各分量操作相同，数据无关。

并行性粒度：计算-通信比，每次通信可完成的工作量。

## 向量处理机

流水方式处理向量数据。

横向处理：每次处理【完】一个分量。N次RAW，2N次功能切换。不适用。

纵向处理：每次做完一个操作。分量间0次RAW，向量间1次RAW，1次功能切换。

纵横处理：分N/n组（n是容量），组间横向，组内纵向。分量间0次RAW，向量间N/n次RAW，2N/n-1次功能切换。

### 向量处理机结构

存储器-存储器结构：

- 向量功能部件是流水化的标量部件，每拍流出一个结果。
- 要求MEM每拍输出一次源opd，对带宽要求较高，性能不理想。
- MEM：多体交叉+多体并行。
- 指令格式：OP Bs1 Bs2 Bd len，B为起始位置，len是长度。

寄存器-寄存器结构：

![image-20210527162814782](.\..\..\typora-user-images\image-20210527162814782.png)

- 指令处理部件：取指译码，若标量指令直接控制，若向量指令给向量指令控制部件。
- 向量寄存器：标量数组，每拍读/写一个分量。性能还可以。
- 向量长度寄存器：数据长度，当前还要处理多少数据，译码时写。
- 向量屏蔽寄存器：某些元素不参与运算（如除0），if语句。（如果用跳转指令，性能爆炸。因此向量处理机一定会有屏蔽功能。）
- 指令格式：OP Vs1 Bs1 Vs2 Bs2 Vd Bd len，V是VREG编号，B是起始index。

### 性能优化

#### 并行执行

无冲突的指令可并行执行。

无冲突：功能部件不结构冲突，VREG不冲突：RAW、WAR、RAR、WAW。

RAR：读同一个VREG的不同下标，但是一个VREG只配一个读counter(下标计数，读一个就++)。一个VREG有一个读counter和一个写counter。

#### 链接技术

指令仅含RAW冲突，分量可用时即可启动。因为读/写有单独的counter。

计算题：算串行、并行、并行+链接指令执行时间。

还有向量屏蔽控制、使用存储器组（独立存储体）。

## 阵列处理机

并行方式处理向量数据。

一个CU同时管理多个PE（process element）并行操作。

阵列机={N, C, I, M, R}，N PE数，C CU直接执行指令集（标量指令），I PE执行指令集，M PE屏蔽方案集，R IN寻径功能集。

阵列处理机属于SIMD，属于专用机（IN功能以某类算法为背景）。

### 结构与原理

#### 分布式结构

每个PE自带私有MEM（LM，local memory），IN用于PE间单向通信（reg互相传）。

I/O操作：LM有2种编址方式（公共/私有）。公共：PE编号#私有编址，或者交叉编址。

通信操作：通信指令（提前说明IN即PE互连方式）。







架构的原理，影响性能的因素，如何运用。



## GPU











