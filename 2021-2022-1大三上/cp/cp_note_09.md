# cp 09 code optimization

删除公共子表达式，改成引用以前已经算过的值。

乘法搞成加法减法。比如每次++i，x=4*i，就搞成了x+=4。

把归纳变量（没听懂）都删了。

## 局部优化

局限于基本块内的优化。

基本块：只有一个入口一个出口的顺序执行序列。

如何将程序划分为基本块：

- 先找所有入口语句，再找相应的出口语句。

- 入口：第一个语句，跳转语句的目标，紧跟在条件转移语句后的语句。

- 出口：

  ![image-20211218224722319](.\..\..\typora-user-images\image-20211218224722319.png)

- 检查，删除不在任何一个基本块内的语句（永远执行不到）。

以基本块为节点，构成程序的流图。

### 基本块的DAG表示

自底向上从左到右，遍历变量的有向无环图。

![image-20211219054034358](.\..\..\typora-user-images\image-20211219054034358.png)

![image-20211219054054235](.\..\..\typora-user-images\image-20211219054054235.png)

一个基本块可以用一个DAG来表示。

删除无用的赋值（令x=1，还没有用呢，又让x=2了），但是一开始不会减少临时变量个数。

根据出基本块活跃的符号以及依赖的符号，进一步删代码。

![image-20211219060123923](.\..\..\typora-user-images\image-20211219060123923.png)

![image-20211219061007555](.\..\..\typora-user-images\image-20211219061007555.png)

## 循环优化

大概就是展开循环，把一些变量定义在循环外……？

这大概不是重点。

全局优化也不是重点。













