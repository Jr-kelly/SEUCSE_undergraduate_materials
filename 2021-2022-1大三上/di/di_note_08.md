# di 08 二值图像处理

## 距离定义

d4 = |Δx| + |Δy|。

d8 = max(Δx, Δy)。

前景距离和背景距离的定义，必须一个d4，一个d8。

连通，connectness：距离=1。

## 形态学滤波器，morphological filtering

（根本就不是滤波器，不是线性系统。）

（建议参照线性系统的卷积。）

结构元 <-> 卷积核。结构元有一个尺寸，通常是奇数。

（偶数的话，比如说用卷积求梯度，求出来的边界会比真实边界向左/右偏一个像素。）

最基本的两种运算：腐蚀 & 扩张。

### 腐蚀，erosion $\ominus$ 

把结构元在输入图像上遍历，如果结构元的前景区域在输入图像上并不都是前景点，则把这个点腐蚀成背景点。

作用：使目标收缩，孔洞扩大，去除图像小颗粒噪声和目标之间的粘连。

### 扩张，dilation $\oplus$ 

与腐蚀相对的运算。

把结构元在输入图像上遍历，如果结构元的前景区域在输入图像上有一个前景点，则把这个点扩张成前景点。

作用：使孔洞收缩，目标扩大，消除图像目标中的小颗粒噪声，填补凹陷。

注意，腐蚀和扩张不是逆运算，先腐蚀再扩张不一定得到原图（比如把所有前景点都腐蚀没了）。

希望保持前景面积不变：腐蚀扩张次数大致相等。

### 开运算，opening operator $\circ$ 

$X\circ B=(X\ominus B)\oplus B$，先腐蚀再扩张。

作用：光滑目标轮廓、消除小目标（如去掉毛刺和孤立点等），在纤细点处分离物体，同时并不明显改变目标面积；

剪掉边界上的毛刺和孤零零的前景点（噪声）。

也可以 $[X\ominus B\ominus B\ominus B]\oplus B\oplus B\oplus B$。

### 闭运算，closing operator $\bullet$ 

$X\bullet B=(X\oplus B)\ominus B$，先扩张再腐蚀。

作用：在保持原目标的大小与形态的同时，填充凹陷、弥合孔洞和裂缝。

把前景区域的小洞补上。开运算是剪枝，闭运算是补洞。

### 边界提取，boundary extraction operator

边界：紧邻背景点的前景点。

$\part X=X-(X\ominus B)$，B是 3*3 填满的卷积核（d8的边界）十字架型的卷积核（d4的边界），我减去我的腐蚀（腐蚀就是把前景刨掉一圈）。

## 区域和边界的相互转换

### 区域填充，region filling operator

迭代：

- $Y_0=P$，P是在前景区域布的种子。
- $Y_k=(Y_{k-1}\oplus B)\cap X^c,~k=1,2,3,...$ 
- 当 $Y_k=Y_{k-1}$ 时，terminate，输出 $Y_k\cup X$。

（X是边界，$X^c$是X的补集，B是 d4/d8 的卷积核，与运算是把掉到边界里点抹掉。）

### 链码 & 边界跟踪，chain-code & contour tracing

一步一步沿着边界走，最后会走到起始点。

方向编码，链码 chain code。就像这样（d8的方向编码）：
$$
\left[\begin{array}{}
3 & 2 & 1 \\
4 & P & 0 \\
5 & 6 & 7
\end{array}\right]
$$

- 初始化：最东面的边界点，方向朝 0；
- 依次判断 右前、前、左前 是否存在前景点。
  - 是： 前进到下一边界点，修改初始方向为小于等于前进方向的偶数编号（就是不改变面朝的方向，面朝方向为东西南北之一）。
  - 否： 初始方向+=2，逆时针转 90°。
- 结束条件： 回到起始点 / 同一点连续修改初始方向4次（原地转一圈，发现自己在孤岛）。

链码：具有位移不变性，但没有旋转不变性。

差分链码：具有旋转不变性。每一步不记录前进方向，记录方向的改变量。

### 距离图 & 距离变换，distance map & distance transform

距离变换的目的是生成距离图。

距离图：前景像素要走多少步才能到背景像素。

逆向扫描，backward scanning：

- 按照光栅扫描顺序（从左到右一行一行从上到下，像写字一样）。
- 该像素是背景：0。
- 该像素是前景：
  - d4：min(上方像素值, 左方像素值) + 1。
  - d8：min(上方, 左上方, 左方) + 1。
- 然后我们按照逆光栅扫描顺序（就是逆过来），再来一遍。值 = min(老值, 逆光栅的新值)。

应用：截取目标的骨架，即距离（在某个截线方向）的极大值点。



