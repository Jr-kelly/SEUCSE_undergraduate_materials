# di 05 图像复原

Image Restoration。

两个根本问题：

- 准确了解【影响成像质量的成像过程】。
- 设计用于【补偿/消除影响因素】的方法。

图像增强 & 图像复原异同点：

- 相同：提高图像质量。
- 区别：
  - 图像增强：提高人眼主观感受，主观的，没有参考目标。
  - 图像复原：提高图像真实质量，【复原】出理想成像条件下的图像，理想成像条件下的图像就是参考目标。

理想图像（完美成像）、实际图像（非完美成像）、估计图像（复原后）。

案例1：对雾霾天气下的拍照过程进行建模，图像复原。

案例2：完美解决的经典问题：运动模糊。

超分辨复原（图像面积增加、表达更多图像细节）和图像放大（只是像素变多、增加面积、复制像素份数）是两回事。

## 线性模糊模型

$$
g(x,y)=h(x,y)*f(x,y)+\eta(x,y)
\\
G(u,v)=H(u,v)\cdot F(u,v)+N(u,v)
\\
\hat f(x,y)=\hat h(x,y)*g(x,y)=\hat h(x,y)*[h(x,y)*f(x,y)+\eta(x,y)]
\\
\hat F(u,v)=\hat H(u,v)\cdot G(u,v)=\hat H(u,v)\cdot[H(u,v)\cdot F(u,v)+N(u,v)]
$$

$h(x,y)$：degradation，差劲成像环境的糟糕卷积核，我们可以通过建模得到它。多数降质过程是低通滤波过程，例如散焦模糊、运动模糊。

η：噪声。白噪声：频谱分布均匀。

$\hat h(x,y)$：用来图像复原的卷积核。

### 方法：逆滤波

观察频域等式，希望 $\hat H$ 和 $H$ 乘积为1，N=0（噪声=0）。得到 $\hat H(u,v)=\frac 1{H(u,v)}$。
$$
\hat F(u,v)=F(u,v)+\frac{N(u,v)}{H(u,v)}
$$
编程细节：H（差劲传递函数）可能为0，放在分母上很危。

逆滤波的问题：噪声是客观存在的。降值函数H是低通滤波器，高频分量很小。噪声除很小的数，会被严重放大。

## 方法：维纳滤波，wiener filter

是线性滤波器。

希望：
$$
E\{|f(x,y)-\hat f(x,y)|^2\} \rarr \min
$$
有：
$$
\hat F(u,v)=\frac{H^*(u,v)S_f(u,v)}
{S_f(u,v)|H(u,v)|^2+S_n(u,v)} G(u,v)
\\
\hat F(u,v)=\frac{H^*(u,v)}{|H(u,v)|^2+S_n(u,v)/S_f(u,v)}G(u,v)
\\
S_n(u,v)=|N(u,v)|^2, S_f(u,v)=|F(u,v)|^2
$$

- G是实际图像的频谱，H是降值函数的频谱，*是共轭。
- Sn是噪声的功率谱，Sf是信号的功率谱。

如果可以估计出噪声能量和信号能量，就可以计算维纳滤波器的传递函数。

但通常，将噪声与信号分离十分困难。因此做简化，把【噪声功率谱 / 信号功率谱 $S_n(u,v)/S_f(u,v)$】用一个常数 K 来替代，噪声越大K越大。

类似于【为了不让分母=0】的魔改。当K=0时，退化成逆滤波。

## 模型：运动模糊（匀速直线运动）model of uniform linear motion

τ：曝光时间；v：物体运动速度。则相机接收到的光线：$g(x)=\int_0^\tau f(x-vt)dt$。

令a=vτ，a是一个距离参数。则有$g(x)=\int_0^a f(x-t)dt$。（忽略了系数v）
$$
g(x)=h(x)*f(x)
\\
h(x)=
\left\{\begin{array}{}
1 & (0\le x\le a) \\
0 & otherwise
\end{array}\right.
$$
降值函数就是均值滤波器。只需要确定参数 a。

### 确定参数的方法：cannon 方法

假设运动只发生在 x 轴（频域的 u 轴）。

那么对每一行的像素：$G(u)=H(u)F(u,y)$。

![image-20211115102850820](.\..\..\typora-user-images\image-20211115102850820.png)

各个零点的间隔 k，对相位的贡献是 $\pi$ 。因为$H(u)=\sin(\pi ua)/\pi ua$，所以$a=1/k$。

目前有一个问题：频谱可能也有很多零点，但这些零点不是我们想要的（传递函数的零点），如何区分？

cannon的解决方法：
$$
\sum_y G(u)=\sum_y H(u)F(u,y)=H(u)\sum_y F(u,y)
$$
求和后，各行频谱的零点落在一处是小概率事件，就只剩下传递函数零点了。

考虑噪声：
$$
\sum_y G(u)==H(u)\sum_y F(u,y)+\sum_y N(u,y)
$$
将各行的噪声平均起来，可以当作常数。因此不寻找频谱零点了，寻找极小值点。

估计运动发生的方向：

- 首先，直接高通滤波得到的信号，比先低通滤波再高通滤波的信号，能量更大。
- 所以我们对各个方向做高通滤波、求信号能量，极小值对应的方向就是运动方向。
