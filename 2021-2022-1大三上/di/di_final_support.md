## 思考

### 图像分割

图像分割怎么说啊……

特征提取（类间差异 类内相似）+ 分类器（输入特征 输出标签）。

目前看到的特征只有灰度特征、边界特征，大概就是灰度域的卷积结果。

分类器：阈值法（确定阈值：正态分布拟合得交点，谷点阈值，大津方差，最大熵阈值）

区域增长：背景光不均匀，增长的一致性条件。

对于那个玄学细胞图，我现在的想法是，因为它有3类，所以我们首先进行一个高斯滤波的降噪，然后搞3个正态分布函数来拟合灰度直方图，用梯度下降来算参数。然后找3个正态分布的两个交点，用交点当作阈值，进行面积占比计算。

如果背景光不均匀：乘性背景光：来一个retinex，取对数 → 高通滤波 → exp。加性背景光：直接高通滤波，用原图减去频率特别低的分量。

#### fzm的细胞分割

大致思路：

- 先把细胞拿出来。
- 然后进行形态学补洞，确保拿出整个细胞。
- 从细胞里拿出细胞核。

具体步骤：

- 分割整个细胞，找到直方图上从右到左的第一个谷点，作为背景和细胞质的分割点。（提取整个细胞）
- 对得到的每个细胞区域使用形态学方法补洞，做闭运算。（“整个”细胞，确保细胞里面没有洞）
- 对每个细胞分割出细胞核，采用阈值法，阈值选取所有细胞像素的Ostu阈值。（摘出细胞核）

收获：

- 形态学可以补洞……
- 先拿到整个细胞、再拿到细胞核的图像分割思路。

讨论：

- 另一种【初步得到整个细胞】的思路是，先拿到一些初始点（不论在核还是在质），然后增长。分割细胞质和细胞核问题不是很大，主要难点在把细胞抠出来。
- 区域增长需要选初始种子。直觉上灰度直方图应该至少有两个谷点（但是因为噪声很多，可能有一大堆谷点，所以不考虑一开始高斯滤波一下吗），选最白的点把背景直接增长掉，嗯！
- 范老师他选阈值的方法是，找到直方图上从右到左的第一个谷点，作为背景和细胞质的分割点。然后选更暗的那一些像素一通区域增长，总之就是希望得到整个细胞。
- 或者我们整个题都用区域增长来做，用直方图两个谷点间的点作为细胞质的种子，第二个谷点后的点作为细胞核的种子。唯一问题就是，是不是真的有两个谷点。
- 如果降完噪之后谷点还是有一大堆，那么我们就选头尾两个谷点。如果谷点只有一个，成一个U型的样子，细胞质灰度的高斯分布（假设是）平躺在中间，导致根本看不出谷点。那么，我们确信这一个谷点是在细胞质，然后把灰度直方图从中间切开，对两边的分布用最大熵阈值切下来一段，把切下来的两端拼起来作为细胞质。

### 图像复原

两个影响图像的因素：降质函数 + 噪声。

线性模糊模型：搞一个用来图像复原的卷积核。
$$
g(x,y)=h(x,y)*f(x,y)+\eta(x,y)
\\
G(u,v)=H(u,v)\cdot F(u,v)+N(u,v)
\\
\hat f(x,y)=\hat h(x,y)*g(x,y)=\hat h(x,y)*[h(x,y)*f(x,y)+\eta(x,y)]
\\
\hat F(u,v)=\hat H(u,v)\cdot G(u,v)=\hat H(u,v)\cdot[H(u,v)\cdot F(u,v)+N(u,v)]
$$

#### 逆滤波

观察频域等式，希望 $\hat H$ 和 $H$ 乘积为1。得到 $\hat H(u,v)=\frac 1{H(u,v)}$。
$$
\hat F(u,v)=F(u,v)+\frac{N(u,v)}{H(u,v)}
$$
编程细节：H（差劲传递函数）可能为0，放在分母上很危。所以我们采取一些trick：好像叫截至的逆滤波，由于降质卷积核一般是低通滤波，所以频率大到一定程度就 → 0了，所以我们只对频率小（u²+v²≤R²）的分量进行逆滤波。

#### 维纳滤波，wiener filter

是线性滤波器。

希望：
$$
E\{|f(x,y)-\hat f(x,y)|^2\} \rarr \min
$$
有：
$$
\hat F(u,v)=\frac{H^*(u,v)S_f(u,v)}
{S_f(u,v)|H(u,v)|^2+S_n(u,v)} G(u,v)
\\
\hat F(u,v)=\frac{H^*(u,v)}{|H(u,v)|^2+S_n(u,v)/S_f(u,v)}G(u,v)
\\
S_n(u,v)=|N(u,v)|^2, S_f(u,v)=|F(u,v)|^2
$$

- G是实际图像的频谱，H是降值函数的频谱，*是共轭。
- Sn是噪声的功率谱，Sf是信号的功率谱。

如果可以估计出噪声能量和信号能量，就可以计算维纳滤波器的传递函数。

但通常，将噪声与信号分离十分困难。因此做简化，把【噪声功率谱 / 信号功率谱 $S_n(u,v)/S_f(u,v)$】用一个常数 K 来替代，噪声越大K越大。

类似于【为了不让分母=0】的魔改。当K=0时，退化成逆滤波。

#### 运动模糊

就是一个某一方向上的均值滤波。

确定方向：

- 引理：直接高通滤波的信号，比先低通滤波再高通滤波的信号，能量更大。
- 我们对各个方向做高通滤波、求信号能量，极小值对应的方向就是运动方向。

确定均值滤波的卷积核大小：

- cannon的解决方法：首先我们进行一波旋转，把运动方向转到x轴。
- 然后对x轴一行一行的像素求和+DFT。因为对【\_---\_】形状的卷积核，那个传递函数是一跳一跳的，可以用第一个零点（极小点）位置来确定卷积核大小。
- ![image-20211115102850820](./../..\typora-user-images\image-20211115102850820.png)
- 各个零点的间隔 k，对相位的贡献是 $\pi$ 。因为$H(u)=\sin(\pi ua)/\pi ua$，所以$a=1/k$。

### 图像增强

来头脑风暴吧！

降噪：

- 中值滤波，均值滤波，高斯滤波。时间上的平均。加权均值滤波器，指把窗口中心像素复制多份。

锐化：

- unsharp masking：抽离高频分量，进行增强。也可以反向用来降噪。可以分好多频段，每个频段乘一个系数。
- laplacian：梯度的散度，$\grad\cdot\grad f=\grad^2f=\frac{\part^2 f_x}{\part x^2}+\frac{\part^2 f_y}{\part y^2}$。DFT：$-(u^2+v^2)F(u,v)$。拉普拉斯过零点，可以作为精确边界。把二阶导数乘一个＜0 的权重，加到原来函数上去，就是unsharp masking。
- 同态滤波器，retinex，整体对比度增强。I → log 变成 logL+logR → unsharp masking → exp → I hat。对log结果进行高通滤波。

增强整体对比度：

- 直方图均衡！gamma校正！不过，它们非线性，会改变频率信息，因此要在均值滤波之后。

## 考纲 & 重点

### 考纲

教学大纲：

- 分析、设计及实现，数图处理相关的工程应用系统。
- 应用线性系统的分析方法，分析数字图像的特性；
- 在分析目标任务的基础上，设计并实现图像增强处理方案；
- 设计和实现图像特征提取方法、及分类器，以完成图像中目标的分割。
- 对于图像特性的分析能力；
- 主要算法的设计思路及性能分析；
- 图像处理流程的设计。

总结：

- 常见的算法，性能分析。（图像压缩算法）
- 设计并实现：图像增强，图像复原，图像分割。

### 重点

- 二维FFT可以用一维FFT实现，证明。
- 模拟滤波卷积 / 形态学处理 / 直方图均衡，画灰度直方图，模拟Huffman编码（？）
- 设计并实现：图像增强，图像复原，图像分割。

## 真题

18（bxd出题）：

1. 二维FFT可以用一维FFT实现，证明。
2. 低通滤波器为什么能降噪，噪声的频域特性。
3. 灰度直方图的特点，灰度映射的合理性。
4. 压缩比和失真率的定义，两者的权衡，JPEG压缩流程。
5. 给出系统框图，证明是线性系统，得到传递函数，推断系统作用。
6. 设计：图像分割。
   1. 分析图像性质，描述设计思路。
   2. 给出框图和大致算法。
   3. 说明可能遇到的问题和应对方案。

19：

1. 构造灰度映射（线性变换）。
2. Huffman编码。
3. 设计提高对比度+降噪算法。
4. 直方图均衡算法。
5. 画灰度直方图。
6. 二维傅里叶变换的 F(0,0) 的物理意义。
7. 高斯滤波器为什么能降噪，噪声的频域特性。
8. 模拟中值滤波 / 均值滤波。

20（bxd出题）：

1. 给定图片，选择对应的灰度直方图 / 频域图。
2. 模拟中值滤波 / 均值滤波。
3. 给出系统框图，得到传递函数，推断系统作用。
4. 设计：图像分割。计算出细胞的数目，听说是形态学。
5. 设计：图像复原。得到监控中行驶车辆的车牌号，运动复原。