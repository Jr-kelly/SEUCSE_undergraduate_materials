# 数字图像处理 实验三 实验报告

<p align='right'>09019106 牟倪



[TOC]



## 一、实验要求

设计图像增强处理流程，要求：

- 实现图像细节增强。
- 增强后，图像噪声没有明显放大。

## 二、处理流程

算法选取：

- 锐化算法：拉普拉斯算法。
- 降噪算法：改造后的中值滤波器。

处理流程：中值滤波降噪 → 拉普拉斯锐化 → 中值滤波降噪。

流程图：

```mermaid
graph LR
S(原图像) -->
A[降噪 - 中值滤波] -->
B[锐化 - 拉普拉斯] -->
C[降噪 - 中值滤波] -->
E(增强结果)
```

## 三、算法具体设计

### 3.1 拉普拉斯算法

拉普拉斯算子的定义：
$$
\grad^2 f=\frac{\part^2 f}{\part x^2}+\frac{\part^2 f}{\part y^2}
$$
用后向一阶差分近似一阶偏微分：
$$
\frac{\part f}{\part x}=f(x,y)-f(x-1,y)
\\
\frac{\part f}{\part y}=f(x,y)-f(x,y-1)
$$
用后向一阶差分近似散度：
$$
\grad\cdot f=\frac{\part f}{\part x}+\frac{\part f}{\part y}
=2f(x,y)-f(x-1,y)-f(x,y-1)
$$
为了计算简便，用前向一阶差分近似拉普拉斯算子（如果用后向一阶差分，数学形式不太好看）：
$$
-\grad^2 f=-[f_x(x+1)-f_x(x)+f_y(y+1)-f_y(y)]
\\
=-[f(x+1,y)-2f(x,y)+f(x-1,y)]-
\\ [f(x,y+1)-2f(x,y)+f(x,y-1)] \\
= 4f(x,y)-f(x+1,y)-f(x,y+1)-f(x-1,y)-f(x,y-1)
$$
可以得到如下的卷积核（被称为4-邻域卷积）：
$$
\left[\begin{array}{}
0&-1&0\\
-1&4&-1\\
0&-1&0
\end{array}\right]
$$
另一种卷积核将对角线方向的灰度变化也纳入考虑，被称为8-邻域卷积核（经过实践，8-邻域卷积的效果更好）：
$$
\left[\begin{array}{}
-1&-1&-1\\
-1&8&-1\\
-1&-1&-1
\end{array}\right]
$$
我们采用8-邻域卷积。

拉普拉斯锐化的过程：将拉普拉斯算子下的图像乘一个小于零的系数 -k，加到原图像上。由此得到以下的卷积核：
$$
\left[\begin{array}{}
-k&-k&-k\\
-k&8k+1&-k\\
-k&-k&-k
\end{array}\right]
$$
只要进行一次卷积，就可以得到锐化结果了。

（编程细节：对于图像边缘，无法进行完全的卷积，直接取原图像像素。）

### 3.2 改造的中值滤波器

- 取窗口尺寸为3*3，事先声明长度为11的数组。
- for 循环遍历图像：
  - 事先将窗口中心像素复制两份，存入数组。
  - for 循环遍历窗口：
    - 将窗口中的像素存到数组里；
  - 对11个像素值进行排序。
  - 取中间三个像素值，取平均，将其作为降噪后的新像素值。

## 四、评价

膝盖图像：

原图（灰度窗取 250 500）：

![image-20211115120106062](.\..\..\typora-user-images\image-20211115120106062.png)

处理后（灰度窗取 250 500，锐化系数 k=1）：

![image-20211115120111866](.\..\..\typora-user-images\image-20211115120111866.png)

可以看出，膝盖骨的边缘有明显增强，膝盖骨的褶皱变得更容易看清，但噪声有一些增多。

胸椎图像：

原图（灰度窗取 2048 4096）：

![image-20211115120635405](.\..\..\typora-user-images\image-20211115120635405.png)

处理后（灰度窗取 2048 4096，锐化系数 k=1）：

![image-20211115120639975](.\..\..\typora-user-images\image-20211115120639975.png)

可以看出，肋骨的线条清晰了很多，噪声基本没有变化。

肺图像：

原图（灰度窗取 3000 2000）：

![image-20211115120648998](.\..\..\typora-user-images\image-20211115120648998.png)

处理后（灰度窗取 3000 2000，锐化系数 k=1）：

![image-20211115120701674](.\..\..\typora-user-images\image-20211115120701674.png)

可以看出，肋骨的线条清晰了很多，肺内部的组织纹理更容易看清楚，噪声没有明显变化。

总结：图像细节得到明显增强，同时噪声没有明显放大。

## 五、附录：思考 & 探索过程

为什么采用中值滤波器：

- 因为开始做实验的时间比较晚，所以我先问了问同学的情况。我发现，采用线性方法进行降噪效果不佳，边界受损严重。同时，如果噪点不削弱就进行锐化，小噪点会变成大噪点，图像质量进一步下降。
- 考虑到线性方法具有交换律和结合律，因此本质上都是对频谱的各个频率分量大小进行调整。削弱高频分量会导致边界模糊，增强高频分量会导致噪声严重，我们需要在锐化和降噪之间做一个权衡。而在直觉上，这样的权衡需要精细调整参数，才能达到图像效果的增强；而且，一套参数不一定适用于所有图像，没有普适性。
- 如果我们跳出线性方法的框架，会不会找到更优的做法？在直觉上，采用中值滤波器降噪，可以消除噪点，并且保留边界，达到更好的效果。因此我采用了中值滤波器。

为什么采用【降噪 → 锐化 → 降噪】的处理流程：

- 拉普拉斯算法的原理是“锐化过渡边界，锐化灰度值变化”，而噪点的灰度值相比周围像素有很明显的变化，噪点会被拉普拉斯算法放大。所以，在锐化之前，先进行一次中值滤波降噪，尽量消除噪点的影响。
- 但是，中值滤波器无法消除尺寸大于窗口大小/2的噪点，仍会有噪点存留并被锐化放大。所以，在拉普拉斯锐化后，再进行一次中值滤波降噪。

为什么改造中值滤波算法：

- 拉普拉斯锐化后，像素的噪声被明显增强，产生了“雪花电视屏幕”的画面（尤其是膝盖图像）。因为中值滤波不包含均值操作，所以只能减少“雪花电视屏幕”像素的数量，不能抹平“雪花电视屏幕”像素值与周围像素值的差距。
- 改造后的算法引入了均值操作，起到了一定的平滑作用。
- 同时，这样改造不会明显损害图像的清晰度。窗口中心像素有三份。如果灰度的变化均匀理想，窗口中心像素会占据中位数的位置；而复制三份窗口中心像素、再对最中间三个像素的取平均，平均值仍然是窗口中心像素值，因此没有影响。这是我设计算法的考虑。



