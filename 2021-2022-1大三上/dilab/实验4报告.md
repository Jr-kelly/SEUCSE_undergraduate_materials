# 数字图像处理 实验四 实验报告

<p align='right'>09019106 牟倪



[TOC]



## 一、实验目的

- 设计图像分割算法，完成给定图像的分割。
- 将“米粒”像素标记为 255，“背景”像素标记为 0，以 BMP 格式保存成文件。

## 二、处理流程 & 算法设计

### 2.1 图像特点观察 

![seed](.\..\..\typora-user-images\seed.bmp)

实验图像如图所示，具有这样的特点：

- 像素只存在两个分类，一类是较亮的米粒，一类较暗的背景。
- 米粒有多个互不接触的区域，背景则是联通的一个区域。
- 图像中存在较多噪点，因此不能直接把灰度值作为特征值。
- 背景光照不均匀，上部整体较亮，下部整体较暗。因此不能对整张图像直接应用阈值法。

根据以上观察，我们考虑：

- 使用区域增长法；在背景区域布下一些种子，就可以增长得到整个背景区域，其余的区域就是米粒区域。
- 考虑结合图像平滑（低通滤波）的思想，将像素邻域的加权平均值作为特征值，力图消除噪点的影响。
- 考虑到背景区域偏暗，认为特征值最小（加权平均灰度最暗）的像素一定属于背景区域。为了加快处理过程，将图像分为n*n个等大的小块，取每个小块中特征值最小的像素作为种子。
- 考虑到栈的深度优先搜索（DFS）可能会多次搜索重复的区域，而队列的广度优先搜索（BFS）在直觉上可以减少重复搜索的情况。为了加快处理过程，将栈改为队列。

### 2.2 处理流程

按照区域增长算法的通用流程进行处理。

1. 定义特征值：特征值为像素邻域灰度值的加权平均值，即，图像与特定卷积核的卷积，其中卷积核起到低通滤波的作用。
2. 设置种子：将图像分为 n 个等大的小块，取每个小块中特征值最小的像素，设置为背景区域的种子。
3. 定义一致性条件：两个像素特征值之差的绝对值小于阈值ε，则两个像素为同类；
4. 使用队列实现增长：
   1. 将初始种子入队；
   2. 弹出队首的像素点；
   3. 标记该像素点为“已处理”；
   4. 遍历所有“未处理”的邻点，判断邻点是否与该像素点同类；
      - 是：入队；
      - 否：继续；
   5. 重复2-4，直到队空。
5. 得到分类图像：将“已处理”的像素值赋成 255，“未处理”的像素值赋成 0。

流程图如下所示：

![seed](.\..\..\typora-user-images\实验4流程图.png)

## 三、实验及结果分析

取卷积核为
$$
\left[\begin{array}{}
0 & 0.005 & 0.005 & 0.005 & 0 \\
0.005 & 0.025 & 0.05 & 0.025 & 0.005 \\
0.005 & 0.05 & 0.64 & 0.05 & 0.005 \\
0.005 & 0.025 & 0.05 & 0.025 & 0.005 \\
0 & 0.005 & 0.005 & 0.005 & 0
\end{array}\right]
$$
，小块数 n*n = 16，阈值 ε = 6.009。分割结果如下所示。

![seed_result](.\..\..\typora-user-images\seed_result.bmp)

可以看出，所有“米粒”都被正确标注，部分背景像素没有被正确标注。

改进思路：

1. 更加精细地调整卷积核、阈值等参数。
2. 或者，
   - 构造出尺寸与“米粒”相当、边缘像素值为0、中央像素值为255且近似米粒形状的卷积核，对图像进行卷积，识别出“米粒”的位置。需要构造各个朝向的“米粒卷积核”，进行多次卷积。
   - 对每一个“米粒”位置，设置一颗种子，用区域增长算法得到“米粒”，就可以避免背景像素被标注为米粒了。

