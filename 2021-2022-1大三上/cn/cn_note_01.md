# cn 01 introduction

重点：

- internet的模型。
- 分组交换和电路交换的模型。
- 4种时延，相关计算。
- 计算机网络常用性能指标：速率、带宽（模拟电路是Hz范围，数字电路里就是速率）、吞吐量、时延、时延带宽积 bandwidth-delay product、往返时间RTT、（信道）利用率。

internet的一种分类：

- 个域网PAN：personal，能在便携式消费电器与通信设备之间进行短距离通信，覆盖半径一般在10m之内，如蓝牙耳机。
- 局域网LAN：local，局部地区形成的区域网络，分别范围有限，大到一栋建筑，小到办公室内的组网；电脑WLAN接入，打印机共享等。
- 城域网MAN：metropolitan，范围覆盖一个城市的网络。
- 广域网WAN：wide，覆盖很大地理区域，如地区和国家。

## 什么是internet

network：billions of connected computing devices（ppt语）。【端系统 end system】通过【通信链路 communication link】和【分组交换机 packet switch】连接到一起，由这三部分组成（我的理解）。

- end system：又名主机host，但host特指计算机，而end system泛指各种计算设备。位于internet的边缘。

  - hosts：有时被划分成client和servers，server通常在数据中心。server是端系统。server其实是软件，如nginx。所以说软件也可以是端系统。

- communication link：分为wireless/wired links。
  - 传输速率：bit/s，bps，Kbps。（计算题中，1k=10³，不用1024算。但1B=8b。
  - 带宽，bandwidth：
    - 模拟信号：能有效通过该信道的【信号最大频带宽度】。
    
    - 数字信号：单位时间内，链路能够通过的数据量（bit/s，bps，kbps）。
    
    - 带宽与传输速率的关系：香农定理。
    
      - 在有噪声的信道里面：
    
      $$
      C=Blog_2(1+S/N)
      $$
    
      - C：信道支持的最大速度/信道容量；B：带宽；S：平均信号功率；N：平均噪声功率；S/N：信噪比。
    
      - 带宽越大，极限传输速率越高。
  
- packet switch：两种最著名的类型是【路由器（router）】，【链路层交换机（link-layer switch）】。link-layer switch通常用于【接入网】中，而路由器通常用于【核心网络】中。
  - router：通过计算路径，得到这个包下一个传给谁。存储转发，寻径。

internet：network of networks（老师语），世界范围的计算机网络（课本）。

ISP：internet service provider，因特网服务提供商。每个ISP是一个【由多个分组交换机和多段通信链路组成】的网络。

protocols：

- 端系统、分组交换机和其他internet部件都要运行【协议】。
- 协议定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其他事件所采取的动作。
- TCP（transmission control protocol，传输控制协议）和IP（internet protocol，网际协议，定义了路由器和端系统之间发送和接受的分组格式）是internet中最重要的两个协议。

protocol的三要素：（选择题）

- 语法：规定传输数据的格式（如何讲）；
- 语义：规定所要完成的功能（讲什么）；
- 时序：规定各种操作的顺序（双方讲话的顺序）；

### network of networks

星形的（有一些无线也可以理解为星形），环形。

network of networks：我们现在使用的网络是分层的结构，第一层是国家层面的ISP，下面是地区级的，然后是第三层……ISP集中在一起，group of ISP通过IXP（internet exchangepoint）交换信息，ISP网络实现存储转发。下一层ISP星形连接本层ISP。

IXP：一个汇合点，多个ISP能够在这里共同对等（互不结算），全球大概300个（书）。

## network classification

![image-20210811111709558](.\..\..\typora-user-images\image-20210811111709558.png)

- network edge：网络边缘。
- access networks：接入网，用来把边缘接入网络，是边缘接入的第一个网。端系统连接到其【边缘路由器】的物理链路。
  - 边缘路由器：端系统到任何其他远程端系统路径上的第一台路由器。
  - 家庭接入网：
    - DSL：digital subscriber line，数字用户线，最初的上网方式。
    - 电缆：国外（尤其美国）广泛采用。频分多路复用。混合同轴电缆。
    - FTTH：fiber to the home，国内广泛采用。无源光纤网络PON。
    - 拨号和卫星。
  - 企业接入网：
    - 以太网：局域网的一种。
    - 无线接入：标准的协议是wifi。无线局域网（WLAN），广域蜂窝网。
- network core：除了网络边缘和接入网，剩下都是网络核心。通过路由器连接在一起。

网络连接的物理媒体：，

- 导引型媒体：电波沿着固体媒体前行。双绞铜线（twisted pair），同轴电缆（coaxial cable），光纤（fibre）。
- 非导引型媒体：电波在空气或外层空间中传播。陆地无线电信道（terrestrial microwave，LAN，cellular蜂窝接入），卫星无线电信道。

通信的几个概念：

- 单工：一条线路上只能单方向通信，多用于广播和电视领域；
- 半双工：同一时间内，通信双方中只能有一方发送或接收信息。局域网最早使用半双工技术；
- 全双工：同一时间内，通信双方可以发送/接收信息，不会发生冲突。大量的局域网交换机和网卡采用全双工技术。
- 多路复用技术：将一个物理信道分为多个逻辑信道，多路信号同时在一个物理信道传输，可以提高带宽的利用率和传输效率。
  - 频分FDM，时分TDM，码分DMA（数学，基于每个人的地址不一样），波分（用于光纤）。
- 载波：在调制中，其特征（振幅、频率、相位）通过添加信息波来修改的波。就是一个载体。就是单边带正弦幅度调制的那个正弦波。
- 调幅（amplitude modilation，AM）：通过添加信息信号来修改载波信号的振幅，不会更改载波的频率。
- 调频（frequency modulation，FM）：通过添加信息信号来修改载波信号的频率，不会更改载波的振幅。适合远距离。
- 交换（switching）：是一种在网络上的节点之间建立连接和发送信息的方法。是一种决定【信息需要到达何处】以及【到达其目的地的最佳可能路径】的技术。

## network core

核心网络：交换信息，信息传递。

交换信息的两种方式：电路交换（曾经的途径），分组交换（现在的途径，重要）。

### 分组交换

ARPANET创新地采用了分组交换技术（判断）。

packet：分组，源end system将长报文划分为小数据块。

存储转发传输：store- and- forward transmission。

存储转发时延：中间结点收到一个完整packet后立刻转发，【分组数】+1。

排队时延：输出缓存排队的时延。

丢包：packet到达某中间结点时发现缓存已经满了，到达的packet或已在缓存内的一个packet被丢弃。

转发表：将目的地址（的一部分）映射成为输出链路，就是目的地址→链路的mapping。

优点：

- 更高的带宽利用率，支持更多的用户。
- 无需共享带宽 no bandwidth division。
- 按需使用 no dedication allocation，无需预留 no reservation。
- 更简单，更有效，实现成本更低。

缺点：

- 资源竞争 resource contention，拥塞congestion。
- 存储转发 store & forward。（不知道为什么是缺点）

### 电路交换

资源预留：首先寻径建立固定通道。连接期间，该网络链路会为本次连接预留恒定的带宽，no sharing。然后尽管传就可以了，只要在这个带宽限制里。与电话相似。

复用：FDM频分多路复用，TDM时分多路复用。

时延：电路创建时延+传输时延。没有拥塞造成的时延（优点）。

### 四种时延类型

- 处理时延：nodal processing，处理报文，当报文到达入口时，根据报文的目的地送到相应的出口。
- 排队时延：queueing，到达包的速率＞发送速率，在缓冲区排队。
  - 流量强度=L\*a/R，R是propagation rate，L是packet length，a是average packet arrival rate。
  - 如果流量强度接近于0，则queueing delay很小；如果接近于1，则queueing delay可能会很大，并且排队情况保持不变；如果＞1，则到来的比发出去的多，排队时间无穷大。
- 发送时延：transmission，把你发出去的时延，L/R，L是packet length，R是接口发射速率（单位是bps）。（aka传输时延）
- 传播时延：propagation，从发送出去至到达下一节点入口的时延。d/r，d是physical link的长度，r是传播速率（单位是速度）。

这里可能会出计算题，见ppt例题。

工具：tracert（windows）traceroute（linux）可以用来测网络时延。

### 网络性能指标

吞吐量：throughput，用户流量中转所能达到的【峰值】，瓶颈链路的传输速率。是的，吞吐量是一种峰值。

RTT：往返时延，round-trip time。

- 从发送方发送数据开始（不包括trassmission，只包含propagation，只计算链路上的时间），到发送方收到来自接收方的确认，经历的总时间。
- 一般拿ping时间除2来近似，但也不完全相等，跟ping的协议有关系。

时延带宽积：bandwidth-delay product，传播时延*带宽，按bit计数的链路长度。

- 发送的第一个bit即将到达终点时（一个传播时延），router正在发送第几个bit。
- 链路上充满了bit时，链路上bit的数目。
- 如果将【时延带宽积管道】比作传输链路，那么宽带链路对应的时延带宽积观点就比较宽。

有效吞吐量：goodput。单位时间内，目的地正确接受到有效信息（不包括报文头）的数目。

利用率：

- 信道利用率：某信道有百分之几的时间是被利用的。
- 网络利用率：全网络的信道利用率的加权平均值。

丢包率：所丢失数据包的数量占所发送数据包的比率。

时延抖动：变化的时延称为抖动，jitter。

## internet的分层结构

网络如何组织internet中的软硬件？（end sytem，routers，links，applications，protocols，hard/software）

网络体系结构：层与协议的集合。

分层实现的好处：

- 独立性强，适应性强，易于实现和维护，有利于促进标准化、

分层实现的原则：

- 层数应适中，每层功能应明确，层与层应相互独立，层间单向引用 。

### protocol的分层结构

概念：

- 网络体系结构：层和协议的集合。一个特定的系统所使用的一组协议，即每层的协议，称为协议栈。
- 层次栈：网络使用层次结构的协议栈，每一层都使用其下一层所提供的服务，并为上层提供自己的服务。
- 接口：在每一对相邻层之间，定义了下层向上层提供哪些服务原语。
- 对等实体：不同机器上构成相应层的实体成为对等实体。一侧封装，另一侧对应解封装。

发送端：层层封装；接收端：层层解封装。

每一层封装都加了报文头（描述信息，发给对等实体那一层的谁）。

不同层对应协议数据单元（PDU Protocol Data Unit，就是 message segment datagram frame 这些）。

![image-20210825103106673](.\..\..\typora-user-images\image-20210825103106673.png)

服务原语的分类：

- 面向连接：每个“请求”或“响应”后，都等待对方产生一个“指示”或“确认”动作。
- 无连接：packet携带了完整的目标地址，传输过程不需要应答。

服务与协议的关系：

- 协议是“水平”的：面向对等实体；
- 服务是“垂直”的：下层为上层提供；
- 实体使用协议来实现其定义的服务；

分层结构的优缺点：

- 有利于管理；
- 功能模块化，变化不影响其他层；
- 功能的冗余，每层都提供查错控制。
- 层与层间的依赖。

internet协议栈：

- 应用层：application。internet的应用层包括很多协议（HTTP FTP等）。某些网络功能，也是借助特定应用层协议完成的。（如把用户友好的端系统名字转换成32位网络地址，这个是借助域名系统DNS完成的。）
- 传输层：transport。在应用程序端点直接传输应用层报文。两个运输协议TCP UDP。把传输层的分组packet叫做报文段segment。
- 网络层：internet。将数据报datagram从一个end system移动到另一个end system。传输层协议向网络层递交segment和地址。IP协议。
- 链路层：link。网络层向链路层递交datagram，链路层将它移动到下一个节点。把链路层packet称为帧frame。
- 物理层：physical。将frame的一个一个bit从一个节点移动到下一个节点。

据fzm的理解，TCP/IP模型是internet协议栈的一种。

Internet（互联网）与internet（互连网）的区别：

- Intenet特指遵循 TCP/IP 标准、利用路由器将各种计算机网络互连起来而形成的、覆盖全球的、特定的互连网，使用TCP/IP，是一个专有名词；
- internet泛指由多个不同类型计算机网络互连而成的网络，还可以使用其他协议，是一个通用名词。

### OSI模型

7层，标准模型。非常完美，但是太复杂了。要会背结构和英文。

- 应用层：application，做什么/完成什么功能：应用程序（FTP、Email、Telnet）。通过应用层协议，提供应用程序便捷的网络服务调用。
- 表示层：representation，内容怎么表示、数据怎么转换、怎么加密、怎么压缩。关注所传递信息的语法和语义，管理数据的表示方法，传输的数据结构。
- 会话层：session，怎么对话怎么交互，该谁讲话从哪讲起。在应用程序之间建立和 维持会话，并能使会话获得同步。双工、半双工、单工、断点续发。
- 传输层：transport，对方在哪，提供端到端可靠的数据传输。将数据从源端口发送到目的端口（进程到进程）。实现什么样的传输，TCP。流量控制、差错控制、拥塞控制。
- 网络层：network，走哪条路，将数据包跨越网络从源设备发送到目的设备。将packet传给正确的主机。routing寻径，路由协议，IP。
- 数据链路层：data link，每步怎么走，将数据组成帧，点到点可靠传输，实现相邻（neighboring）网络实体间的数据传输。帧同步、差错控制、流量控制、媒体访问控制。
- 物理层：physical，如何利用物理介质，定义如何在信道上传输bit，规定物理信号、接口、信号形式、 速率等，比特。

上3层：资源子网；下3层：通信子网。

评价：

- 结构清晰，概念明确，适合作教学内容。
- 产生在协议发明之前，非常通用 。
- 从未真正被实现：TCP/IP已成为事实标准，OSI缺少厂家支持。
- 技术实现糟糕：
  - 层次功能划分不是十分合理：会话层、表示层很少内容，数据链路层、网络层内容繁杂。
  - 模型和协议实现复杂，运行效率低。
  - 分层间功能重复：差错控制、流量控制等在不同层反复出现。事实上这是所有分层结构的问题。
- 非技术因素：TCP/IP实现为UNIX一部分（免费），OSI被认为是政府和机构的强加标准。

### TCP/IP参考模型

- 4层：应用层，传输层（TCP层），互联网层（IP层），网络接口层。
- 5层：应用层，传输层（TCP层），网络层（IP层），链路层，物理层。
- 其中只定义了前三层。
- application layer, transport layer, internet layer, link layer。
- 以其中最主要的两个协议TCP/IP命名，ARPANET采用。
- 先有TCP/IP协议栈，后有TCP/IP参考模型，参考模型只是用来描述协议栈的。
- 没有表示层和会话层，这些功能留给developer。
- 摒弃电话系统中“笨终端&聪明网络”的设计思路。聪明的终端，简单的网络。
- 建立在简单的、不可靠部件上的可靠系统。
- 可在各种底层物理网络上运行(IP over everything)，可支持各类上层应用(Everything over IP) 。
- TCP/IP模型的网络层仅支持无连接通信（IP）。

评价：

- 一开始就考虑到异构网互联问题。
- 一开始就兼顾面向连接的服务和无连接的服务。
- 有很好的网络管理功能。
- 明确的目标导向，把不重要的需求都抛弃了。
- 未能体现核心概念：没有明确区分服务、接口、协议。
- 不具备通用性：不适于描述TCP/IP之外的其它协议栈。
- 链路层和物理层一起被定义为网络接口层， 而非真正意思上的分层。
- 模型欠缺完整性：未包含物理层与数据链路层（至关重要的部分，反而让它普及了）。
- 不能提供完全安全可靠的服务。
- 每一层都有可靠性措施（为自己负责），冗余。

## 国际标准组织

ISO：国际标准化组织。ITU：国际电信联盟，负责无线通信。WIFI联盟：商业联盟，有WiFi的商标。W3C：WWWC，万维网联盟。IETF：互联网工程任务组。IRTF：Internet研究任务组。ISOC：互联网协会。IAB：互联网体系结构委员会。

RFC是请求评论的意思。Internet标准以RFC文档的形式公开。



## 作业题讲解

### 计算模型

k：链路个数，d：链路传播时延，x：文件大小，p：包大小，b：带宽，s：电路建立时间。

分组交换：

k\*(d+p/b)+(x/p-1)*(p/b)

第一个包的propagation delay+第一个包的transmission delay+剩下包跟着第一个包的n-1份 最大router转发时延。

老师的公式：kd+(x/p)*(p/b)+(k-1)\*(p/b)

（什么k-1次的存储转发延迟）

电路交换：

s+x/b+k*d

电路建立时间+最极端的router转发整个文件的时延+整个propagation delay。

### 概念

服务和协议的区别：

- 协议：对等双方达成约定。
- 服务：两方的协议栈中，下层为上层提供。
- 实体使用协议来实现其定义的服务。









