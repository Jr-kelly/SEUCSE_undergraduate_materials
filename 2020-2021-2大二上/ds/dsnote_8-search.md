# 第8章：搜索 Search

在每个对象中有若干属性，其中有一个属性，其值可**唯一**地标识这个对象，称为**关键码**；因此搜索结果唯一；

## 顺序搜索 Sequential Search

使用“监视哨”：Element[CurrentSize].key = x;

这样子总是能找到，简化了查找失败的处理；

平均搜索长度ASL：Average Search Length：pici求和；(n+1)/2；

顺序搜索递归算法；

## 二叉搜索树 Binary Search Tree

中序遍历：二叉排序树 Binary Sorting Tree；

时间不够了，快点看！

平均搜索长度达到最小的扩充的二叉搜索树，称作最优二叉搜索树；等概率不等概率；

## AVL树

平衡因子 balance factor=**右子树高度-左子树高度**；

注意！！在答题时写清楚平衡因子定义！！

插入导致不平衡：左单旋，右单旋，先左后右双旋，先右后左双旋；

### 插入一个新结点后：

从插入位置沿通向根的路径回溯，检查各结点的平衡因子；

如果在某一结点发现高度不平衡，停止回溯；

从发生不平衡的结点开始，沿刚才回溯的路径取直接下两层的结点；

设三个节点为ABC；

若bfA和bfB同号，单旋；不然双旋；

### 左单旋：

1				2

​	2  ->  1		3

​		3

右单旋对称；

### 先左后右双旋：

​		1

2

​	3

23左旋，321右旋；

先右后左双旋对称；

其实用挂钩更好想，到时候可以用来验证；

### 如何在寻找插入路径时修改bf：

先插入了。然后回溯；

一路改变bf。若bf从±1变成0了，就break掉；就这样。

所以要回溯两遍，按照我的思路。不知道wy老师怎么想。

### AVL树的删除！

必须沿 被删除的结点 通向根的路径，反向追踪 高度的变化 对路径上各个结点的影响；

好难啊，但是我可以讲明白，给我一个机会；

我们从被删除的那个节点开始看起：回溯回溯，找到bf绝对值大于1的地方。没找到就是平衡的。

找到一个地方之后，向下两层，然后按照插入一样处理？我不知道，应该不会考编程吧，太变态了。

计划以题代学。

## B树

一棵 m 阶B树或者是空树, 或者是满足下列性质的树：

- 根结点至少有2个子女；

- 除根结点以外的所有结点 (不包括失败结点)至少有$\lceil m/2\rceil$个子女；

- 所有的失败结点都位于同一层；


子女个数是关键码个数+1；所以根节点**上**至少有一个关键码，剩下节点**上**至少有$\lceil m/2\rceil-1$个关键码；

高为h的B树，最多容纳 ${m^{h}-1}$ 个节点，最少容纳 $2(\lceil m/2\rceil^{h-1}-1)$ 个节点；

我爆炸了。第一层（根节点）就可以容纳m-1个key呢。

h>=logm(N+1); h<=log(m/2)(N/2+1)+1;

### B树的插入

自底向上分裂节点；

当分裂一个非根的结点时，需要向磁盘写出 2 个结点；

当分裂根结点时，需要写出 3 个结点。

假设: 所用的内存工作区足够大, 使得在向下搜索时, 读入的结点在插入后向上分裂时不必再从磁盘读入。

则完成一次插入操作，需要读/写磁盘的最大次数：

 = 找插入（叶）结点向下读盘次数 h +

分裂非根结点时写盘次数 +

分裂根结点时写盘次数 = h+2(h-1)+3 = 3h+1

### B树的删除

自底向上合并；

如果没问题，那就没问题；

如果少了，试图从旁边借；借的时候要旋转，和单旋差不多；

如果借不来，就和旁边合并；合并的时候还从parent节点拉下来一个关键码；

我需要模拟一下。。

调整一个结点时：

需要从磁盘读入1个兄弟结点、写出2个结点。无论是借还是合并吧。

调整到根的子女时，需要写出3个结点。？？？我没看懂。希望不考。

如果：所用的内存工作区足够大, 使得在向下搜索时, 读入 的结点在做删除时不必再从磁盘读入。

那么：完成一次删除操作，读写磁盘的最大次数 

= 找删除元素所在结点向下读盘次数 + 调整结点时读写盘次数 

≤ h+ 3(h-1)+1 = 4h-2

## B+树，赶快赶快

所有关键码都存放在叶结点中；

上层的非叶结点的关键码是其子树中最大（或最小）关键码的复写；

叶结点包含了全部关键码及指向相应数据记录存放地址的指针，且叶结点本身按关键码从小到大顺序链接；

在叶结点中关键码有序地排列。

我们**约定使用最大关键码**。约定，注意。

### B+树插入

仅在叶节点上进行；

插入最坏要读写磁盘3h+1次；

### B+树删除

删除：1. 借；

2.借不到的时候合并，自底向上合并；

删除叶节点最大key时，上层复写可不改，因为上层复写是分界符的作用；

## Hashing

同义词synonyms：哈希值一样；

冲突：同义词；溢出：bucket满了；

### hash fuction

除法取余；平方取中；折叠：移位折叠：加法；分界折叠：对折；

### 溢出处理

开放寻址 Open addressing

链接 chaining



















