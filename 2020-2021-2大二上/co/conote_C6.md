# co第六章 精简版

总线：连接多个设备，用于信息传输的一组公共信号线；

主设备可发起总线操作，从设备只能响应；

Q1：总线使用权如何管理？管理的实现方法？不同从设备如何标识？

请求-分配方式，获得时撤销请求；仲裁器，BRBGBS线；用地址（是ID的意思吗）；

Q2：总线有哪些类型？DBus/ABus/CBus，同步/异步，系统/片内/通信；

总线周期是完成一次总线操作的时间，仲裁+传输；

传输周期是传输一次的时间；

## 总线操作过程

仲裁+寻址+数据传送+结束，每个阶段都是交互；

### 请求及分配阶段 仲裁阶段

主设备：有总线需求时发出请求BRi；Request；

总线仲裁器：向所选主设备发出总线允许信号BGi；Grant；

Q1：总线使用权获得的表示？请求何时撤销？传输周期结束的表示？

BGi=1时发生BSi=1；BSi从0到1后 至 BSi从1到0前；BSi从1到0；

Q2：总线仲裁何时进行？

空闲BS=0且有总线请求BR=ΣBRi=1时；

### 寻址阶段

有使用权的主设备：发送地址和命令；

所有从设备：判断自己是否被选中，被选中时响应总线操作；

### 传送阶段

传输时机：从设备就绪：读用ACK表示，写用WR#表示；

### 结束阶段

结束时机：从设备接收完毕：读用RD#表示，写用ACK表示；

## 总线仲裁：我们学集中式仲裁

### 链式查询方式

基本思想：自动轮询各个主设备，被询问时才可获得使用权；

#### 实现：

开始：BS=0，BR=1时；结束：BS=1时；

被询问、有请求时BSi=1，BGi_OUT=0；

被询问、无请求时BSi=0，BGi_OUT=1；

$BG=\overline{BS}*BR; BSi=BGi_{IN}*BRi; BGi_{OUT}=BGi_{IN}*BRi$；

会断链；时延不一样；

### 计数器定时查询方式

基本思想：定时查询各个主设备，被询问时才可获得使用权；

#### 实现：

仲裁器：BS#*BR=1时，每隔Δt让DevNo=DevNo+1；

主设备：BSi=BS#*(DevNo==ID)；

时延应该也不一样；

### 独立请求方式

基本思想：每个主设备有一个请求线，根据连接次序仲裁；

统一裁决，用指定算法，不需要主设备参与；

实现：总线仲裁器的内部电路，时延固定！

## 总线传输与定时

总线事务：一对设备间的一次信息传输过程；

功能参数：设备个数（11/1多），传送功能（读/写/读改写），数据个数（常规/突发），寻址范围；

### 总线传输过程：用传输协议表示：

MEM读事务=送地址/命令+等待MEM响应+传送数据+结束；

MEM写事务=送地址/命令+传送数据+等待MEW响应+结束；

### 总线定时方式，操作步骤的时长约定

#### 同步定时方式

统一时钟信号，步骤时长固定；

#### 异步定时方式

通过联络信号的握手/应答实现，步骤时长可变；

请求，响应，撤销请求，撤销响应；

#### 半同步定时方式

通过时钟信号和联络信号的握手共同实现，步骤时长基于时钟信号，可以延长；

## 总线性能

总线宽度：**数据**总线的位数；

### 总线数据传输率

总线宽度*总线操作工作频率（即数据传输次数/秒）

### 总线带宽

总线的最大数据传输率，常用Mbps表示(Mb/s)；

总线宽度*数据传输时的工作频率（不考虑地址传送等时间）

B=w*f/m；w总线宽度，f总线时钟频率，m每个数据传送所需时钟周期数；

总线负载能力：指 信号电平 保持在有效范围 内时，所能连接的设备数量，常用个表示；

## 总线分类

片内总线，系统总线，通信总线（外设）；























