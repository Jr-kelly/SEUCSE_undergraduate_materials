# co第三章

## 存储系统概述

### 技术指标

存储容量；

存取速度：访问时间（收到命令-完成操作），存取周期（两次访存操作最短间隔，T访问+T恢复）；

传输速度：MEM带宽（最大数据传输率，W引脚位数/T存取周期），Mbps，MBps（貌似考过）；

### 程序访问的局部性原理

时间局部性：最近访问过的信息，将再次被访问；

空间局部性：最近访问信息的相邻信息，将很快被访问；

层次结构组织：cache+主存+辅存；

### 工作过程(层次+变换+访问)

需求：1. 程序(文件)**存放在辅存**中；2. 程序执行时**预先装入主存**中；3. **按逻辑地址访问**存储系统；

[层次管理＋]地址变换＋存储器访问

## RAM

### SRAM芯片组成引脚组织

存储矩阵、地址译码器、I/O门、读写电路、控制电路（1WR+1RD or 1WR/RD#+1#CS）；

那些计算；

### DRAM芯片组成引脚组织

刷新/再生；

地址引脚减半，分两次接收；

地址锁存器（因为地址引脚减半）、时序控制电路、再生电路；

控制信号：行地址选通RAS#、列地址选通CAS#、读/写WE；

把RAS#当做片选；

刷新：集中式刷新，分散式刷新，异步式刷新；

DRAMC；

## 主存

### 主存的逻辑设计

位扩展：位并联法，扩展位数（字长）；

字扩展：地址串联法，扩展字数（位数不变），高位片选；

字位扩展；

需要去画一画；

### 主存与CPU的连接

数据线直连，地址线低位直连，高位和控制信号一起生成MEM控制信号（片选，读写）；

### 提高访存速度的技术

#### 增强的DRAM：

FPM DRAM（快页模式）：同一行操作共用RAS，省去行地址锁存时间；

SDRAM（同步）：同步工作方式+突发传输（T突发＝T存取＋n*T传送）；

DDR SDRAM（双倍数据速率）：CLK的上升沿及下降沿都I/O；

![image-20210121112305004](.\..\..\typora-user-images\image-20210121112305004.png)

#### 多体交叉存储器

交叉访问：

每隔TM/m启动一个体(TM后可输出)，I/O采用突发传输方式(带宽变为原来的m倍，BM*=m)；

2TM输出m个数据，第一个周期（同步工作方式）启动m个存储体，第二个周期突发传输；

并行访问：增设数据掩码引脚；

## cache

### cache的基本原理

命中率：H=命中次数/访存总次数；

平均访问时间：T=H*Tc+(1-H)(Tc+Tm)=T命中+(1-H)T缺失（缺失引起的时延）；

cache-主存的信息交换单位：块；

cache地址：cache行号+块内地址；MEM地址：主存块号+块内地址；

行：有效位V，标记Tag；

cache容量：数据区；cache总容量：数据区+控制区；

![image-20210121130739823](.\..\..\typora-user-images\image-20210121130739823.png)

### cache的地址映射方式

#### 直接映射

MEM地址：区号+区内块号+块内地址；

cache地址：行号+行内地址；

行号=区内块号；tag=区号；

用一个比较器查找，命中：V=1且tag=区号；

#### 全相联映射

MEM地址：主存块号+块内地址；

cache地址：行号+行内地址；

主存块可放到任意行中；tag=主存块号；

设cache行数为G，用G个比较器同时比较；

冲突率最低，成本最高，速度较快；

#### 组相联映射

映射规则：将Cache的行分组，每个组有**n个行（n路组相联）**；（n个可选择的，对应组内行号）

主存块i可放到Cache的某个组j的任意行中，j＝i mod G/n；

cache地址：组号+组内行号+块内地址；

MEM地址：群号+群内块号+块内地址；

组号=群内块号；组号=群内块号；

用 组内行数 个比较器同时比较，命中：V=1且tag=群号；

例4：（大难题！）

数据放在几个块中，就要不命中几次；

### cache的替换算法

随机算法：全相联映射；

先进先出算法：FIFO，最早调入，调入行CNT←0，其余行CNT←(CNT)＋1，组相联映射；

#### LRU算法：

Least Recently Used，最近最少使用算法；

每个Cache行需设置**LRU位**(表示候选行内的块访问次序)；有log2(组内行数)位；

设置组内行数个计数器（硬件开销同FIFO）；

一开始都赋为 组内行数-1；每次访问，把访问的块置0，其余+1（饱和运算）；

替换时选LRU位最大的；

### cache的写策略

全写法：立即写；

写命中时，数据写入Cache，同时写入主存；

写缺失时，通常数据**直接写入主存**，目标块不调入Cache；

写回法：

写命中时，数据只写入Cache，不写入主存；

写缺失时，通常目标块调入Cache，数据只写入Cache；

舍弃行时，若脏位=1，则写回；

## 虚拟存储器（了解概念）

主存空间分配：分区、分页；

MMU(Memory Management Unit)—实现虚存-主存的地址变换(**CPU**中)；

段式虚拟存储器（虚地址=段号 段内地址，实地址=段首址+段内地址）；

页式虚拟存储器（虚页号 页内地址；实页号 页内地址）；

段页式虚拟存储器（虚地址=段号 段内页号 页内地址，用段表找页表基址，根据虚页号从页表找到实页号，实地址= 实页号 页内地址）；

地址变换：MMU；缺页：OS；

快表：页表层次结构，TLB在CPU里面；





















